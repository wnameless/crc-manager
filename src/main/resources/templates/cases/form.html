<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="fragments/header :: header-common" />
<body>
	<nav th:fragment="navbar-login" class="navbar navbar-default">
		<div class="container-fluid">
			<div class="navbar-header">
				<a class="navbar-brand" href="/index">CRC Manager</a>
			</div>
			<ul class="nav navbar-nav">
				<li
					sec:authorize="hasRole('ROLE_SUPER') or hasRole('ROLE_ADMIN') or hasRole('ROLE_USER')"><a
					href="/cases">執行案件區</a></li>
				<li sec:authorize="hasRole('ROLE_SUPER') or hasRole('ROLE_USER')"><a
					href="/cases?new">新進案件區</a></li>
				<li sec:authorize="hasRole('ROLE_SUPER') or hasRole('ROLE_USER')"><a
					href="/cases?supp1">新案補充區-CRC</a></li>
				<li sec:authorize="hasRole('ROLE_SUPER') or hasRole('ROLE_USER')"><a
					href="/cases?supp2">新案補充區-PI/SC</a></li>
				<li sec:authorize="hasRole('ROLE_SUPER') or hasRole('ROLE_ADMIN')"><a
					href="/cases?end">結束案件區</a></li>
				<li sec:authorize="hasRole('ROLE_SUPER') or hasRole('ROLE_ADMIN')"><a
					href="/cases?none">非CRC管理案件區</a></li>
				<li sec:authorize="hasRole('ROLE_SUPER') or hasRole('ROLE_ADMIN')"><a
					href="/cases/search">案件搜尋與匯出</a></li>
			</ul>

			<ul class="nav navbar-nav navbar-right">
				<li><a href="/logout" class="fa fa-sign-out fa-2x"></a></li>
			</ul>
		</div>
	</nav>

	<div id="caseFormDiv" class="container col-md-6 col-md-offset-3"></div>

	<script type="text/babel" th:inline="javascript">
const Form = JSONSchemaForm.default;

const schema = JSON.parse([[${formSchema}]]);
const uiSchema = JSON.parse([[${formUiSchema}]]);
const formData = JSON.parse([[${formData}]]);

const onSubmit = ({formData}) => {
	console.log("Data submitted: ",  formData);

    $("#caseForm input").each(function(input){ this.setAttribute("name", this.getAttribute("id").substring(5)) });
	document.getElementById("caseForm").submit();
}

ReactDOM.render((
  <Form id="caseForm"
		name="caseForm"
		method="post"
  		action="/cases/[[${formId}]]/form"
		schema={schema}
        uiSchema={uiSchema}
        formData={formData}
		onSubmit={onSubmit} >
     <div>
      <button type="submit" class="btn btn-info">Submit</button>
    </div>
</Form>
), document.getElementById("caseFormDiv"));
	</script>
</body>
</html>