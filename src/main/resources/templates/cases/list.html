<html xmlns:th="http://www.thymeleaf.org">
<div th:fragment="list">
    <table id="jsfTable" class="display">
        <thead>
            <tr>
                <th>動作</th>
                <th>IRB/REC案件編號</th>
                <th class="text-center">CRC</th>
                <th class="text-center">受試者</th>
                <th>試驗中文名稱</th>
                <th>計畫主持人姓名</th>
                <th>預計開始時間</th>
                <th>預計結束時間</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="case : ${jsfItems}">
                <td>
                    <a th:if="!${case.owner} and ${case.status} == ${case.Status.NEW} and ${@perm.canAssign()}" class="btn btn-default btn-sm"
                        th:href="@{'/cases/' + ${case.id} + '/assignment'}">指派 PI</a>
                    <a th:if="${case.owner} and ${case.status} == ${case.Status.NEW} and ${@perm.canAssign()}" class="btn btn-default btn-sm"
                        th:href="@{'/cases/' + ${case.id} + '/status/exec'}">分發 PI</a>
                    <a th:if="${case.status} == ${case.Status.EXEC} and ${@perm.canManage(case)}" class="btn btn-default btn-sm"
                        th:href="@{'/cases/' + ${case.id} + '/permission'}">
                        <span class="fa fa-cogs"></span>
                    </a>
                    <a th:if="${case.status} == ${case.Status.EXEC} and ${@perm.canClose(case)}" class="btn btn-default btn-sm"
                        th:href="@{'/cases/' + ${case.id} + '/status/end'}">結案</a>
                    <a th:if="${case.status} == ${case.Status.END} and ${@perm.canReopen()}" class="btn btn-default btn-sm"
                        th:href="@{'/cases/' + ${case.id} + '/status/exec'}">再執行</a>
                    <a th:if="${case.status} == ${case.Status.NONE} and ${@perm.canRenew()}" class="btn btn-default btn-sm"
                        th:href="@{'/cases/' + ${case.id} + '/status/new'}">重回新案</a>
                </td>
                <td th:inline="text">
                    <a th:if="${@perm.canRead(case)}" th:onclick="${ 'showFormEvent(''' + jsfPath + '/' + case.id + ''')' }">
                        <span><i class="fa fa-search"></i></span>
                    </a>
                    <span th:if="${!@perm.canRead(case)}"><i class="fa fa-search"></i></span> |
                    <a th:if="${@perm.canWrite(case)}" th:onclick="${ 'editFormEvent(''' + jsfPath + '/' + case.id + '/edit' + ''')' }">
                        <span><i class="fa fa-edit"></i></span>
                    </a>
                    <span th:if="${!@perm.canWrite(case)}"><i class="fa fa-pencil"></i></span> [[${case.irbNumber}]]
                </td>
                <td class="text-center">
                    <a th:if="${@perm.canRead(case)}" th:onclick="${ 'showFormEvent(''' + jsfPath + '/' + case.id + '/crc' + ''')' }">
                        <span><i class="fa fa-search"></i></span>
                    </a>
                    <span th:if="${!@perm.canRead(case)}"><i class="fa fa-search"></i></span> |
                    <a th:if="${@perm.canWrite(case)}" th:onclick="${ 'editFormEvent(''' + jsfPath + '/' + case.id + '/crc/edit' + ''')' }">
                        <span><i class="fa fa-edit"></i></span>
                    </a>
                    <span th:if="${!@perm.canWrite(case)}"><i class="fa fa-pencil"></i></span>
                </td>
                <td class="text-center">
                    <a th:if="${@perm.canWrite(case)}" th:href="${jsfPath + '/' + case.id + '/subjects/index'}">
                        <span><i class="fa fa-user-plus"></i></span>
                    </a>
                    <span th:if="${!@perm.canWrite(case)}"><i class="fa fa-user-plus"></i></span>
                </td>
                <td th:text="${case.trialName}"></td>
                <td th:text="${case.piName}"></td>
                <td th:text="${case.expectedStartDate}"></td>
                <td th:text="${case.expectedEndDate}"></td>
            </tr>
        </tbody>
    </table>

    <script type="text/javascript" th:inline="javascript">
		var showFormEvent = function(path) {
			axios.get(path)
			.then(function (response) {
				$('#jsf').html(response.data);
			})
			.catch(function (error) {
				console.log(error);
			});
		};
		
		var editFormEvent = function(path) {
			axios.get(path)
			.then(function (response) {
				$('#jsf').html(response.data);
			})
			.catch(function (error) {
				console.log(error);
			});
		};
	
		$(document).ready(function() {
			$('#jsfTable').DataTable({
				"language" : {
					"url" : "/i18n/datatables-zh-TW.json"
				}
			});
		});
	</script>
</div>
</html>