<html xmlns:th="http://www.thymeleaf.org">
<div th:fragment="list">
    <div class="row">
        <div class="col-sm-4">
            <div class="btn-group dropdown" sd:page-size-selector="dropdown">
            </div>
        </div>
        <div class="col-sm-4">
            <div></div>
        </div>
        <div class="col-sm-4">
            <div class="input-group">
                <input id="search" type="text" class="form-control" placeholder="Search for..." th:value="${search}">
                <span class="input-group-btn">
                    <button class="btn btn-default" type="button" onclick="searchEvent(this)"><span
                            class="fas fa-search"></span></button>
                </span>
                <span class="input-group-btn">
                    <button class="btn btn-default" type="button" onclick="resetEvent(this)"><span
                            class="fas fa-eraser"></span></button>
                </span>
            </div>
        </div>
    </div>

    <table id="jsfTable" class="table table-striped table-hover">
        <thead>
            <tr>
                <th style="width: 70px;" th:text="#{ui.case.table.action}"></th>
                <th style="width: 50px;"></th>
                <th style="width: 130px;">
                    <a class="sorted" sd:pagination-sort="irbNumber" th:text="#{ui.case.table.irbnumber}"></a>
                </th>
                <th class="text-center" th:text="#{ui.case.table.contraindication}"></th>
                <th class="text-center" style="width: 60px;" th:text="#{ui.case.table.subject}"></th>
                <th>
                    <a class="sorted" sd:pagination-sort="trialName" th:text="#{ui.case.table.name.chinese}"></a>
                </th>
                <th class="text-center" style="width: 90px;">
                    <a class="sorted" sd:pagination-sort="piName" th:text="#{ui.case.table.pi}"></a>
                </th>
                <th style="width: 90px;">
                    <a class="sorted" sd:pagination-sort="expectedStartDate" th:text="#{ui.case.table.time.start}"></a>
                </th>
                <th style="width: 90px;">
                    <a class="sorted" sd:pagination-sort="expectedEndDate" th:text="#{ui.case.table.time.end}"></a>
                </th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="case : ${page.content}">
                <td>
                    <div class="dropdown">
                        <button type="button" class="btn btn-default dropdown-toggle" id="dropdownMenu1"
                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                            <span class="glyphicon glyphicon-cog"></span> <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                            <li
                                th:if="!${case.owner} and ${case.status} == ${case.Status.NEW} and ${@perm.canAssign()}">
                                <a th:href="@{'/cases/' + ${case.id} + '/assignment'}"
                                    th:text="#{ui.case.table.action.assign}"></a>
                            </li>
                            <li th:if="${case.owner} and ${case.status} == ${case.Status.NEW} and ${@perm.canAssign()}">
                                <a th:href="@{'/cases/' + ${case.id} + '/status/exec'}"
                                    th:text="#{ui.case.table.action.dispatch}"></a>
                            </li>
                            <li th:if="${case.status} == ${case.Status.NEW} and ${@perm.canAssign()}">
                                <a th:href="@{'/cases/' + ${case.id} + '/status/none'}"
                                    th:text="#{ui.case.table.action.none}"></a>
                            </li>
                            <li th:if="${case.status} == ${case.Status.EXEC} and ${@perm.canManage(case)}">
                                <a th:href="@{'/cases/' + ${case.id} + '/permission'}"
                                    th:text="#{ui.case.table.action.permission}"></a>
                            </li>
                            <li th:if="${case.status} == ${case.Status.EXEC} and ${@perm.canClose(case)}">
                                <a th:href="@{'/cases/' + ${case.id} + '/status/end'}"
                                    th:text="#{ui.case.table.action.close}"></a>
                            </li>
                            <li th:if="${case.status} == ${case.Status.END} and ${@perm.canReopen()}">
                                <a th:href="@{'/cases/' + ${case.id} + '/status/exec'}"
                                    th:text="#{ui.case.table.action.reopen}"></a>
                            </li>
                            <li th:if="${case.status} == ${case.Status.NONE} and ${@perm.canRenew()}">
                                <a th:href="@{'/cases/' + ${case.id} + '/status/new'}"
                                    th:text="#{ui.case.table.action.renew}"></a>
                            </li>
                        </ul>
                    </div>
                </td>
                <td>
                    <a href="#" th:if="${@perm.canWrite(case)}"
                        th:attr="data-edit-path=${jsfPath + '/' + case.id + '/edit'}" onclick="editFormEvent(this)">
                        <span>
                            <i class="fa fa-edit"></i>
                        </span>
                    </a>
                    <span th:if="${!@perm.canWrite(case)}">
                        <i class="fa fa-edit"></i>
                    </span>
                    <a th:if="${@perm.canDelete()}" th:href="@{'/cases/' + ${case.id} + '/delete'}">
                        <span>
                            <i class="fa fa-times" style="color: red; margin-top: 3px;"></i>
                        </span>
                    </a>
                </td>
                <td>
                    <a th:unless="${@perm.canRead(case)}" th:inline="text">[[${case.irbNumber}]]</a>
                    <a th:if="${@perm.canRead(case)}" href="#" th:attr="data-show-path=${jsfPath + '/' + case.id}"
                        onclick="showFormEvent(this)" th:inline="text">[[${case.irbNumber}]]</a>
                </td>
                <td class="text-center">
                    <a th:if="${@perm.canRead(case)}" th:href="${ jsfPath + '/' + case.id + '/contraindications'}">
                        <span>
                            <i class="fa fa-medkit"></i>
                        </span>
                    </a>
                    <span th:unless="${@perm.canRead(case)}">
                        <i class="fa fa-medkit"></i>
                    </span>
                </td>
                <td class="text-center">
                    <a th:if="${@perm.canRead(case)}" th:href="${jsfPath + '/' + case.id + '/subjects/index'}">
                        <span>
                            <i class="fa fa-user-plus"></i>
                        </span>
                    </a>
                    <span th:unless="${@perm.canRead(case)}">
                        <i class="fa fa-user-plus"></i>
                    </span>
                </td>
                <td th:text="${case.trialName}"></td>
                <td class="text-center" th:text="${case.piName}"></td>
                <td th:text="${case.expectedStartDate}"></td>
                <td th:text="${case.expectedEndDate}"></td>
            </tr>
        </tbody>
    </table>

    <div class="row">
        <div class="col-sm-6">
        </div>
        <div class="col-sm-6">
            <nav class="pull-right">
                <ul class="pagination" sd:pagination-split="7" sd:pagination="full"
                    sd:pagination-url="@{'/cases?' + ${@pageUtils.toQueryStringWithoutPage(pageable)}(search=${search})}">
                    <!-- Pagination created by SpringDataDialect, this content is just for mockup -->
                    <li class="disabled"><a href="#" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a>
                    </li>
                    <li class="active"><a href="#">1 <span class="sr-only">(current)</span></a></li>
                </ul>
            </nav>
        </div>
    </div>

    <script th:replace="fragments/notify :: notify" type="text/javascript"></script>
    <script type="text/javascript" th:inline="javascript">
        var showFormEvent = function (node) {
            axios.get($(node).attr('data-show-path')).then(function (response) {
                $('#jsf').html(response.data);
            });
        };

        var editFormEvent = function (node) {
            axios.get($(node).attr('data-edit-path')).then(function (response) {
                $('#jsf').html(response.data);
            });
        };

        var searchEvent = function (node) {
            axios.put('/cases', {}, {
                params: {
                    search: $('#search').val()
                }
            }).then(function (response) {
                $('#jsf').html(response.data);
            });
        };

        var resetEvent = function (node) {
            axios.put('/cases', {}, {
                params: {
                    search: ''
                }
            }).then(function (response) {
                $('#jsf').html(response.data);
            });
        };

        $(function () {
            $('#jsfTable').reflowTable();
        });
    </script>
</div>

</html>